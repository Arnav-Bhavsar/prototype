<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Communication System</title>
</head>
<body>
    <h1>Select Mode</h1>
    <button onclick="showCaretaker()">Caretaker (Send Message)</button>
    <button onclick="showPatient()">Patient Monitor (Receive Message)</button>

    <div id="caretaker" style="display:none;">
        <h2>Caretaker - Send Message</h2>
        <input type="text" id="messageInput" placeholder="Enter message">
        <button onclick="sendMessage()">Send</button>
        <p id="status"></p>
    </div>

    <div id="patient" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; margin:0; padding:20px; box-sizing:border-box;">
        <button onclick="location.reload()" style="position:absolute; top:10px; left:10px; font-size:16px;">Back</button>
        <div id="messageDisplay" style="font-size:10vw; display:flex; align-items:center; justify-content:center; height:90%; width:100%; text-align:center;">Waiting for message...</div>
        <p id="lastUpdated" style="font-size:2vw; text-align:center;"></p>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
          apiKey: "AIzaSyBPeBffn5YYfydjZ8oKvpB5UHXS9r6d8sM",
          authDomain: "patient-monitor-ca78a.firebaseapp.com",
          databaseURL: "https://patient-monitor-ca78a-default-rtdb.firebaseio.com",
          projectId: "patient-monitor-ca78a",
          storageBucket: "patient-monitor-ca78a.firebasestorage.app",
          messagingSenderId: "454324690577",
          appId: "1:454324690577:web:7a068e27db8ddbb9f4a930"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.showCaretaker = function() {
            document.getElementById('caretaker').style.display = 'block';
            document.getElementById('patient').style.display = 'none';
        }

        window.showPatient = function() {
            document.getElementById('caretaker').style.display = 'none';
            document.getElementById('patient').style.display = 'block';
            loadMessage();
        }

        window.sendMessage = async function() {
            const message = document.getElementById('messageInput').value;
            if (!message) return;

            try {
                const timestamp = new Date().toLocaleString();
                await set(ref(database, 'currentMessage'), {
                    text: message,
                    timestamp: timestamp
                });
                
                document.getElementById('messageInput').value = '';
                document.getElementById('status').textContent = 'Message sent at ' + timestamp;
            } catch (error) {
                document.getElementById('status').textContent = 'Error sending message: ' + error.message;
                console.error(error);
            }
        }

        function loadMessage() {
            const messageRef = ref(database, 'currentMessage');
            onValue(messageRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('messageDisplay').textContent = data.text;
                    document.getElementById('lastUpdated').textContent = 'Last updated: ' + data.timestamp;
                } else {
                    document.getElementById('messageDisplay').textContent = 'No message yet';
                }
            });
        }
    </script>
</body>
</html>